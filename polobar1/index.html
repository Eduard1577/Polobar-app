
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel Polobar</title>
  <style>
    body { background: #111; color: white; font-family: sans-serif; padding: 20px; }
    .card { background: #222; padding: 15px; border-radius: 10px; margin-bottom: 10px; }
    .card a { color: #ff5050; text-decoration: none; font-weight: bold; }
    .danger { background: #aa0000; color: white; padding: 6px 12px; border: none; border-radius: 6px; cursor: pointer; }
    .global-actions button { margin: 6px; padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; }
    .clean { background: #4444aa; color: white; }
    .download { background: #008800; color: white; }
    .upload { background: #888800; color: black; }
    .footer { margin-top: 30px; color: #aaa; text-align: center; font-size: 14px; }
  </style>
</head>
<body>
  <h1>ğŸ“‹ Panel Polobar</h1>
  <div id="clientes"></div>

  <div class="card">
    <button onclick="agregarCliente()" style="background: #3333aa; color: white; padding: 10px 20px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer;">
      â• Agregar cliente
    </button>
  </div>

  <div class="global-actions">
    <button onclick="borrarTodosLosHistoriales()" class="clean">ğŸ§¹ Borrar solo los historiales</button>
    <button onclick="descargarBackup()" class="download">ğŸ“¥ Descargar respaldo (.json)</button>
    <input type="file" id="fileInput" style="display: none;" accept=".json" />
    <button onclick="document.getElementById('fileInput').click()" class="upload">ğŸ“¤ Cargar respaldo (.json)</button>
    <button onclick="borrarDatos()" class="danger">ğŸ—‘ï¸ Borrar todos los datos</button>
  </div>

  <div class="footer">Â© Polobar 2025</div>

  <script>
    function renderClientes() {
      const container = document.getElementById("clientes");
      container.innerHTML = "";
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith("saldo_")) {
          const cliente = key.replace("saldo_", "");
          const saldo = localStorage.getItem(key);
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = \`
            <a href="cliente.html?c=\${cliente}">ğŸ‘¤ \${cliente.charAt(0).toUpperCase() + cliente.slice(1)} â€” $\${saldo}</a><br/>
            <button onclick="borrarMovimientos('\${cliente}')" class="danger">ğŸ—‘ï¸ Borrar movimientos</button>
          \`;
          container.appendChild(div);
        }
      }
    }

    function borrarMovimientos(nombre) {
      const confirmar = confirm(\`Â¿Seguro que deseas borrar los movimientos de \${nombre}? El saldo se mantendrÃ¡.\`);
      if (!confirmar) return;
      localStorage.removeItem(\`movimientos_\${nombre}\`);
      alert(\`âœ… Movimientos de \${nombre} eliminados.\`);
      location.reload();
    }

    function borrarTodosLosHistoriales() {
      const claves = [];
      for (let i = 0; i < localStorage.length; i++) {
        const k = localStorage.key(i);
        if (k.startsWith("movimientos_")) claves.push(k);
      }
      claves.forEach(k => localStorage.removeItem(k));
      alert("ğŸ§¹ Historiales eliminados correctamente.");
      location.reload();
    }

    function agregarCliente() {
      const nombre = prompt("ğŸ§¾ Ingresa el nombre del nuevo cliente:");
      if (!nombre) return;
      const clave = nombre.toLowerCase().replace(/\s+/g, '');
      const monto = prompt(\`ğŸ’° Â¿CuÃ¡l es el saldo inicial para \${nombre}?\`);
      if (!monto || isNaN(monto)) return alert("âŒ El saldo debe ser un nÃºmero.");
      localStorage.setItem(\`saldo_\${clave}\`, parseInt(monto));
      localStorage.setItem(\`movimientos_\${clave}\`, JSON.stringify([]));
      alert(\`âœ… Cliente \${nombre} agregado con $\${monto}. Recarga la pÃ¡gina para verlo.\`);
      location.reload();
    }

    function descargarBackup() {
      const datos = {};
      for (let i = 0; i < localStorage.length; i++) {
        const k = localStorage.key(i);
        if (k.startsWith("saldo_") || k.startsWith("movimientos_")) {
          datos[k] = JSON.parse(localStorage.getItem(k));
        }
      }
      const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "respaldo_polobar.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function borrarDatos() {
      const confirmar = confirm("âš ï¸ Â¿EstÃ¡s seguro de que deseas borrar TODOS los datos?");
      if (!confirmar) return;
      const claves = [];
      for (let i = 0; i < localStorage.length; i++) {
        const k = localStorage.key(i);
        if (k.startsWith("saldo_") || k.startsWith("movimientos_")) {
          claves.push(k);
        }
      }
      claves.forEach(k => localStorage.removeItem(k));
      alert("ğŸ—‘ï¸ Todos los datos eliminados.");
      location.reload();
    }

    document.getElementById("fileInput").addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const datos = JSON.parse(e.target.result);
          for (const clave in datos) {
            localStorage.setItem(clave, JSON.stringify(datos[clave]));
          }
          alert("âœ… Respaldo cargado exitosamente.");
          location.reload();
        } catch (err) {
          alert("âŒ Error al cargar el respaldo.");
        }
      };
      reader.readAsText(file);
    });

    renderClientes();
  </script>
</body>
</html>
